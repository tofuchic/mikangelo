# 今回作ったアプリケーション
- 袋から取り出した後の柑橘を、見た目から判別して品種名を教えてくれるアプリ

---

# 実験概要

- 何種類かの蜜柑を[brownie](https://github.com/ksasao/brownie)で見分けることができるかを検証する
- 柑橘を見分けさせるためにどんな写真を学習に使うべきかを検証する

## 前提

- 背景は extract する
- カメラ（M5StickV）と被写体の距離は一定
- <img src="https://raw.githubusercontent.com/tofuchic/mikangelo/main/image/setup.jpg" width="320px">

## 実験の観点

- 写真に写す蜜柑の面
  - 上面（へたが見える角度）
  - 側面
  - 下面

---

# 実験に使う蜜柑の種類

- [柑味](https://kanmi.theshop.jp/)で購入した 2021 年 4 月分の柑橘、計 7 種類（品種名/ラベル名）
  1. 南津海/natsumi
  1. 弓削ひょう柑/yuge
  1. 湘南ゴールド/shonan
  1. さつき八朔/satsuki
  1. レモネード/lemonade
  1. スターライトネーブル/starlight
  1. なったん/nattan

- <img src="https://raw.githubusercontent.com/tofuchic/mikangelo/main/image/kanmi.jpg" width="320px">

# データセット

- 通常の機械学習であれば学習用データ・検証用データ・テスト用データの 3 つを用意するが、柑味から届くみかんは品種毎に 2~3 個のため、学習用みかんとテスト用みかんのみ用意した
  - （学習用みかんとテスト用みかんがそれぞれ1個ずつなので、精度とか再現率とかあんまり出す意味ない）

---

# 実験方法

## 実験 1 - 上面（へたが見える角度）のみ学習させた場合

1. 学習用みかんを使い、学習は一回ずつ行う
   - 7 品種 x 1 パターンで合計 7 回撮影

## 実験 2 - 上面、側面、下面を学習させた場合

1. 学習用みかんを使い、学習は各ケース一回ずつ行う
   - 「弓削ひょう柑だけ側面を何回か学習させる」などはしない
   - 7 品種 x 3 パターンで合計 21 回撮影

1. テスト用みかんの品種ごとに、上面・側面・下面が写るように無作為に配置し、判定される結果を読み取る

---


# 実験結果

## 凡例

- 〇 : 定常的に正しいラベルが表示された
- △ : 正しいラベルを含む複数のラベルで連続的に切り替わった
- × : 正しいラベルを含まない複数のラベルで連続的に切り替わった
- ×× : 定常的に誤ったラベルが表示された
- \- : ラベル判定なし

## 実験 1 - 上面（へたが見える角度）のみ学習させた場合

- 試行回数 1 回

  |     | natsumi |     yuge      | shonan | satsuki | lemonade | starlight | nattan |
  | :-- | :-----: | :-----------: | :----: | :-----: | :------: | :-------: | :----: |
  | top |    ○    | △（lemonade） |   ○    |    ○    |    ○     |     ○     |   ○    |

- 学習後、テスト用みかんの「弓削ひょう柑/yuge」をカメラで捉えたときの動画
  - <img src="https://raw.githubusercontent.com/tofuchic/mikangelo/main/image/video.gif" width="320px">

## 実験 2 - 上面、側面、下面を学習させた場合

- 試行回数 3 回

  - 1 回目

    |        |    natsumi     |           yuge           |     shonan     |   satsuki   |   lemonade    |   starlight   |     nattan     |
    | :----- | :------------: | :----------------------: | :------------: | :---------: | :-----------: | :-----------: | :------------: |
    | top    |       ○        |     ××（starlight）      |       ○        |      ○      |       ○       |       ○       | △（starlight） |
    | side   |       ○        | △（lemonade、starlight） |       ○        | △（nattan） | ××（natsumi） | ××（satsuki） |  △（satsuki）  |
    | bottom | ××（lemonade） |      △（lemonade）       | ××（lemonade） | △（nattan） |       ○       |       ○       |       ○        |

  - 2 回目

    |        | natsumi |           yuge           |     shonan     | satsuki |   lemonade    |   starlight   |     nattan      |
    | :----- | :-----: | :----------------------: | :------------: | :-----: | :-----------: | :-----------: | :-------------: |
    | top    |    ○    |      △（starlight）      |       ○        |    ○    |       ○       |       ○       | ××（starlight） |
    | side   |    ○    |      ××（lemonade）      | △（lemonade）  |    ○    | ××（natsumi） | ××（satsuki） |        ○        |
    | bottom |    ○    | ×（lemonade、starlight） | ××（lemonade） |    ○    |       ○       |       ○       |  △（satsuki）   |

  - 3 回目

    |        | natsumi |          yuge          |     shonan     |   satsuki   |   lemonade    |   starlight   |     nattan      |
    | :----- | :-----: | :--------------------: | :------------: | :---------: | :-----------: | :-----------: | :-------------: |
    | top    |    ○    |           ○            |       ○        | △（nattan） |       ○       |       ○       | ××（starlight） |
    | side   |    ○    |     ××（lemonade）     |       ○        |      ○      | ××（natsumi） | ××（satsuki） |        ○        |
    | bottom |    ○    | ×（lemonade、natsumi） | ××（lemonade） | △（nattan） |       ○       |       ○       |  △（satsuki）   |

---

# 考察（というよりかは、実験結果を見ての感想）

- 部位（上面・側面・下面）ごとの判定結果を総合すれば一意に特定できそう
  - たとえば弓削ひょう柑を判定させた結果を見ると、スターライトネーブル・レモネード・南津海と誤って判定されがちであるが、そのパターンも含めて弓削ひょう柑の性質と考えれば、総合的に弓削ひょう柑であると判断できそう
    - 上面がスターライトネーブル、側面がレモネード、下面が南津海と判定されるような柑橘があったとしたら、弓削ひょう柑である確率が高い
  - 凡例に対して重みを付ける
- 弓削ひょう柑の判定が難しかったが、弓削ひょう柑は形が特徴的だったので人間が見れば分かる
  - へたがある上面と下面の間が細長いのは弓削ひょう柑だけだったが、側面を写すだけではその特徴が捉えられない
    - 3 次元的に学習するために SLAM とかで立体を捉える必要がある？
  - 柑橘の大きさは学習できていない
    - デプスカメラ等を使って物体の大きさも学習できれば精度が上がる？
  - M5StickV のカメラのピクセル数が柑橘の表面の細かい模様を捉え切れていない？
    - 皮の模様が分かる程度に高画素なカメラがあれば精度が上がる？ピクセルを丸め込んでるから意味ない？
- 上面を写しての判定は、他の面を学習したことで精度が落ちている
  - 写す面を増やす際にラベルの数を「yuge-front」「yuge-side」「yuge-back」などと増やせば、へたの情報がそぎ落とされる、などを防げる？
  - （『機械学習なんも分からん』ので教えていただきたい）

---

# 今回の取り組みを通じての感想と課題

- 「さつき八朔」と「スターライトネーブル」と「なったん」が（私の目には）ほとんど同じに見えて、見分けるのは難しいと思ったが、意外と見分けてくれた。すごい！
- 弓削ひょう柑だけは側面を写す際に他の柑橘と比べて 90 度傾いていたが、回転による影響がある学習モデルなのかどうかは気になっている
- 物体認識（セグメンテーション）をした上で学習しているわけではないので、背景が変わっただけで柑橘を見分けてくれないのは、実用性に欠ける
- 部屋の明かりによって写真に写る際の柑橘の色味が変わるはずで、その影響もなくしたい

## 社会問題

- 農家の数が減っているなか、熟練者の技能の引継ぎが問題となっている
  - みかん界隈の例：どのタイミングで何を指標として剪定をすれば良いのかが分からない
